var zhiyou_relate={baseUrl:"http://zhiyou.smzdm.com/",init:function(){var a=this;$(function(){a.init_login_area();});},popup_login_init:function(d){var a=window.location.href;if(d.redirect_url!=undefined){a=d.redirect_url;}var c="https://zhiyou.smzdm.com/user/login/window#redirect_url="+encodeURIComponent(a);var b='<div class="pop" id="pop-login-new" style="display:none;margin-left:-240px;top:30%;">'+'<i class="pop-close icon-cross-lighter"><!--[if lt IE 8]>x<![endif]--></i>'+'<div class="pop-title">'+'<div class="pop_name">登录</div>'+'<a href="http://zhiyou.smzdm.com/resources/js/'+zhiyou_relate.baseUrl+'user/register" class="a_underline" _hover-ignore="1">注册</a>'+"</div>"+'<div class="pop-content">'+'<iframe id="zhiyou_login_window_iframe" frameborder="0" style="width:300px;height:290px;" src='+c+' scrolling="no"></iframe>'+"</div></div>"+'<div id="cover" style="display: none;"></div>';var e="",g="",f="";if($("#pop-login-new").length<=0){$("#footer").after(b);g=$("#pop-login-new");f=$("#cover");}$(document).on("click",".zhiyou_login",function(){g.show();f.show();return false;});$("#pop-login-new").delegate(".pop-close","click",function(){g.hide();f.hide();});$(document).on("click","#cover",function(){g.hide();f.hide();});},popup_login_show:function(){$("#pop-login-new").show();$("#cover").show();return false;},get_header_menu_tpl:function(){var c=$("#zhiyouLoginArea");var b=c.data("ishidelogin");if(b){var d="";}else{var d='<a href="http://zhiyou.smzdm.com/user/register" class="navBarRegister" id="navBar_reg" >注册</a>'+'<a href="javascript:;" id="login_window" class="zhiyou_login navBarLogin">登录<span class="line"></span></a>';}var a=d+'<div class="login_Info" id="navBar_login_Info">'+'<a href="'+me.baseUrl+'user" target="_blank" class="nickName"></a>'+'<i class="icon-down"><!--[if lt IE 8]>&gt;<![endif]--></i>'+'<div class="more_login_Info">'+'<span class="arrow-top"><em></em></span>'+'<ul aria-haspopup="true">'+'<li><a href="http://zhiyou.smzdm.com/user" target="_blank">个人中心</a></li>'+'<li><a href="http://zhiyou.smzdm.com/user/mypost" target="_blank">我的原创</a></li>'+'<li><a href="http://zhiyou.smzdm.com/user/submit" target="_blank">我的爆料</a></li>'+'<li><a href="http://zhiyou.smzdm.com/user/wiki" target="_blank">我的百科</a></li>'+'<li id="user_menu_comment"><a href="http://zhiyou.smzdm.com/user/shoudaopinglun" >我的评论</a></li>'+'<li ><a href="http://test.smzdm.com/user/zhongce">我的众测</a></li>'+'<li id="user_menu_message"><a href="http://zhiyou.smzdm.com/user/message" >我的消息</a></li>'+'<li><a href="http://zhiyou.smzdm.com/user/favorites/youhui">我的收藏</a></li>'+'<li><a href="http://zhiyou.smzdm.com/user/logout">退出登录</a></li>'+"</ul>"+"</div>"+"</div>"+'<div class="submission"> '+'<a href="#">爆料投稿</a>'+'<i class="icon-down"><!--[if lt IE 8]>&gt;<![endif]--></i>'+'<div class="more_submission">'+'<span class="arrow-top"><em></em></span>'+"<ul>"+'<li><a href="http://www.smzdm.com/baoliao/" target="_blank">优惠爆料</a></li>'+'<li><a href="http://wiki.smzdm.com/create/" target="_blank">分享商品</a></li>'+'<li><a href="http://post.smzdm.com/tougao/" target="_blank">原创投稿</a></li>'+"</ul>"+"</div>"+"</div>"+'<div class="more_user_news" id="chief_notice" style="display: none;">'+'<i class="icon-cross-lighter" onclick="javascript:$(this).parent().fadeOut();"></i>'+'<a id="notice_message" href="#"><em></em>条新消息</a>'+'<a id="notice_comment" href="#"><em></em>条新评论</a>'+"</div>";return a;},init_login_area:function(a){me=this;var b=$("#zhiyouLoginArea");b.append(me.get_header_menu_tpl());},request_zhiyou_info:function(c){var a=this;var b=a.baseUrl+"user/info/jsonp_get_current";$.ajax({type:"get",url:b,data:"",dataType:"jsonp",jsonp:"callback",success:function(d){a.user_info_default_callback(d);if(typeof c=="function"){c(d);}},error:function(){}});},bgm:{},user_info_default_callback:function(p){var A=zhiyou_relate;if(p&&!$.isEmptyObject(p)){if(p["bgm"]&&!$.isEmptyObject(p["bgm"])){zhiyou_relate.bgm=p["bgm"];}var n=p.smzdm_id;var u=p.nickname;var D=p.unread;var d=p.logo;var g=p.capabilities;var y=p.avatar.split("small");var k=typeof(y[0])!="undefined"?y[0]:"";if(typeof(y[1])!="undefined"){k+="middle"+y[1];}var B=zhiyou_relate.baseUrl+"user";var t=p.point;var j=p.gold;var o="";var m=p.checkin;var h=p.comment_sync_sina;$("body").append('<input id="log_status" type="hidden" value="1" />');if(g!=""){if(g.administrator||g.editor||g.pinglun||g.edit_posts||g.moderate_comments){$("body").append('<input type="hidden" id="authority" value="editor" />');$("#authority").val("all");}}$("#navBar_login,#navBar_reg, #login_window").hide();$("#navBar_login_Info").find(".nickName").html(u);$("#navBar_login_Info").show();if($("#user_info").length>0){$("#user_info").attr("class","userInfo user_signIn");$("#sign_login").hide();$("#user_info_avatar").attr({"src":k,"alt":u}).unwrap("span").wrap('<a href=" '+B+' " class="userPic" target="_blank"></a>');$("#user_info_name").html('<a href=" '+B+' " title=" '+u+' " target="_blank">'+u+"</a>"+d.medal+d.zhongce_grade+d.goldbl+" "+d.rank);if($("#user_info_score").find("em").length>0){$("#user_info_score").find("em").html(t).end().next("a").andSelf().show();}else{$("#user_info_score").html("积分:<em>"+t+"</em>");}if($("#user_info_gold").find("em").length>0){$("#user_info_gold").find("em").html(j).end().next("a").andSelf().show();}else{$("#user_info_gold").html("金币:<em>"+j+"</em>");}var l=parseInt($("#user_info").attr("needMobileTips"));if(l!=1){}$("#user_info_tosign").unbind("click").bind("click",zhiyou_relate.set_checkin);if(m.has_checkin){$("#user_info_tosign").html("已签到"+m.daily_checkin_num+"天").removeClass("signScore").addClass("signScored").removeClass("zhiyou_login").unbind("click");if(l!=1){$("#user_info_tosign").attr("href","http://www.smzdm.com/qiandao");}}$("#user_info_tosign").removeClass("zhiyou_login");var C=$("#channel").val();if(C!="index"){var z=m.slogan;$(".scoreBox").after(z);}}if(o&&1==o){$("#comment_avatar").attr({"src":no_avatar,"alt":"匿名用户"}).unwrap("span").wrap('<a href="javascript:void(0);" class="userPic"></a>');$("#comment_avatar").parent(".userPic").after(' <span class="comment_nickName grey">匿名用户</span> ');}else{$("#comment_avatar").attr({"src":k,"alt":u}).unwrap("span").wrap('<a href=" '+B+' " class="userPic" target="_blank" title=" '+u+' "></a>');$("#comment_avatar").parent(".userPic").after(' <a href=" '+B+' " class="comment_nickName a_underline" target="_blank"  title=" '+u+' ">'+u+"</a> ");}$(".comment_switch").show(function(){if(h&&$("#commentform").find(".check").length>0){$("#commentform").find(".check").addClass("icon-rightframe");}else{if(h&&$("#commentform").find(".check").length>0){$("#commentform").find(".check").removeClass("icon-rightframe");}}});if(D["notice"]["num"]!=0||D["pm"]["num"]!=0||D["comment"]["num"]!=0){var f=parseInt(D["notice"]["num"])+parseInt(D["pm"]["num"]);if(f!=0){var c=D["notice"]["url"];if(parseInt(D["notice"]["num"])<=0){c=D["pm"]["url"];}$("#notice_message").attr("href",c).find("em").html(f);if(f>99){f="99+";}$("#user_menu_message").find("a").attr("href",c).html("我的消息<span>(<em>"+f+"</em>)</span>");}else{$("#notice_message").hide();}if(D["comment"]["num"]!=0){var x=D["comment"]["url"];$("#notice_comment").attr("href",x).find("em").html(D["comment"]["num"]);if(D["comment"]["num"]>99){D["comment"]["num"]="99+";}$("#user_menu_comment").find("a").attr("href",x).html("我的评论<span>(<em>"+D["comment"]["num"]+"</em>)</span>");}else{$("#notice_comment").hide();}$("#chief_notice").show().find(".close").click(function(){$("#chief_notice").hide();});$("#chief_notice").slideDown("slow");}else{$("#chief_notice").hide();}$("#comment_tips").remove();$("#textareaComment").removeClass("zhiyou_login");$(".noLogin").removeClass("noLogin");var q=$("#textareaComment").attr("default_data");$("#textareaComment").unbind("click").val(q).focus(function(){if($(this).val()==q){$(this).val("");}$(this).css("color","#666");}).blur(function(){if($(this).val()==""){$(this).val(q).css("color","#ccc");}}).change(function(){$("#textCommentSubmit").removeAttr("disabled");});$(".comment_switch").show(function(){if(h=="yes"&&$("#commentform").find(".check").length>0){$("#commentform").find(".check").addClass("icon-rightframe");}else{if(h=="no"&&$("#commentform").find(".check").length>0){$("#commentform").find(".check").removeClass("icon-rightframe");}}});$("#textCommentSubmit").removeAttr("disabled").removeClass("btn_subGrey").addClass("btn_sub");var b=p.banright;if(b.length>0){for(var v=0,w=b.length;v<w;v++){if(b[v]==1){var e=p.bantips;$("#textareaComment").html("").attr("disabled","disabled");$("#comment_error").html(e).show();$("#textCommentSubmit").removeClass("btn_sub").addClass("btn_subGrey").attr("disabled","disabled");$(".comment_switch").hide();$(".atta,.reply").unbind("click");break;}}}showHidenNotice(".login_Info","#chief_notice");showHidenNotice(".submission","#chief_notice");var s=parseInt(p.login_error_num);if(s>=3){var r=$("#captcha_img").attr("data-src");$("#captcha_img").attr("src",r);$(".captcha_switch").show();}if(p.close_comment_enter){$("#textareaComment").html("").attr("disabled","disabled");$("#textCommentSubmit").removeClass("btn_sub").addClass("btn_subGrey").attr("disabled","disabled");$(".comment_switch").hide();$(".atta,.reply").unbind("click");}if(p.is_use_captcha){var r=$("#captcha_img").attr("data-src");$("#captcha_img").attr("src",r);$(".captcha_switch").show();}}return;},set_checkin:function(){var a=this;$("#user_info_tosign").unbind("click");$.ajax({type:"get",url:zhiyou_relate.baseUrl+"user/checkin/jsonp_checkin",dataType:"jsonp",jsonp:"callback",success:function(e){var b=e.error_code;var c=e.error_msg;var d=e.data;if(b==0){window.location.href="http://www.smzdm.com/qiandao";}else{popUp("","#pop-status",c["public"]);}},error:function(){$("#user_info_tosign").bind("click",zhiyou_relate.set_checkin);}});},add_favorite:function(b,a,e){var d=this;var c=d.baseUrl+"user/favorites/";$.ajax({type:"get",url:c+"jsonp_favorite",data:{article_id:b,channel_id:a},dataType:"jsonp",jsonp:"callback",success:function(f){var g={1:"youhui",2:"faxian",5:"haitao",6:"news",11:"yuanchuang",7:"zhongce",8:"pingce",14:"wiki_topic"};if(f.error_code==0){$("#pop-collect .pop_info_show a:first").attr("href",c+g[a]);if(a==7){a=8;}else{if(a==8){a=7;}}popPosition("#pop-collect");$("#pop-collect").show();$("#cover").show();popClose("#pop-collect");$("a[id='collect_"+a+"_"+b+"']").each(function(){$(this).attr("class","fav current");var h=Number($(this).find("em").html())+1;if(h<0){h=0;}$(this).find("em").html(h);});popUp("","#pop-collect","");}else{if(f.error_code==2){$("#pop-nocollect .pop_info_show a:first").attr("href",c+g[a]);if(a==7){a=8;}else{if(a==8){a=7;}}popPosition("#pop-nocollect");$("#pop-nocollect").show();$("#cover").show();popClose("#pop-nocollect");$("a[id='collect_"+a+"_"+b+"']").each(function(){$(this).attr("class","fav");var h=Number($(this).find("em").html())-1;if(h<0){h=0;}$(this).find("em").html(h);});popUp("","#pop-nocollect","");}else{if(f.error_code==5){d.popup_login_show();}else{if(f.error_code==6){}}}}},error:function(){}});},init_favorite_by_cookie:function(){$(".fav").each(function(){var e=new Array([1,"youhui"],[2,"faxian"],[3,"ordershow"],[4,"experience"],[5,"haitao"],[6,"news"],[7,"test"],[8,"test_probation"],[11,"yuanchuang"],[14,"wiki_topic"]);var g=$(this).attr("id");if(typeof(g)!="undefined"){var b=g.split("_");var c=b[2];var d=b[1];for(i=0;i<e.length;i++){var a=getCookie("smzdm_collection_"+e[i][1]);var f=[];if(a){var f=a.split(",");}if(d==e[i][0]&&$.inArray(c,f)>-1){$(this).attr("class","fav current");}}}});},scored:function(c,b){var a=$(c);if(a.find("a").hasClass(b)){a.mouseover(function(){$(this).find("."+b).css("display","none");$(this).find(".scoredInfo").css("display","block");});a.mouseout(function(){$(this).find("."+b).css("display","block");$(this).find(".scoredInfo").css("display","none");});}},zhi_list_callback:function(d,k,j,e,g){if(d.error_code==0){if(e==1){var f=$("#rating_worthy_"+k);f.find(" .scoreAnimate").fadeIn().animate({top:"-30px"},"normal").fadeOut(300);if(f.find("em").length){var b=parseInt($.trim(f.find("em").html()));}else{var h=f.find(" .scoreTotal").text();var c=h.split(" ");var b=parseInt(c[1]);}var b=b+1;if(f.find(" .scoreTotal").length){f.find(" .scoreTotal").html("<b>值</b> "+b);}else{f.find("em").html(b);}}else{var a=$("#rating_unworthy_"+k);a.find(" .scoreAnimate").fadeIn().animate({top:"30px"},"normal").fadeOut(300);if(a.find(" .scoreTotal em").length>0){var b=parseInt($.trim(a.find(" .scoreTotal em").html()));}else{var h=a.find(" .scoreTotal").text();var c=h.split(" ");var b=parseInt(c[1]);}var b=b+1;a.find(" .scoreTotal").html("<b>不值</b> "+b);}}},zhi_detail_callback:function(g,c,b,d,f){var e=$("#rating_"+c);if(g.error_code==0){var h=parseInt($.trim($("#rating_worthy_num").text()));var a=parseInt($.trim($("#rating_unworthy_num").text()));if(d==1){$(e).find(".add").show().animate({"top":"-30px"},600).fadeOut("slow",function(){$("#rating_worthy_num").html(h+1);$("#rating_all_num").html("已有 "+(h+a+1)+" 用户参与");});}else{$(e).find(".reduce").show().animate({"top":"80px"},600).fadeOut("slow",function(){$("#rating_unworthy_num").html(a+1);$("#rating_all_num").html("已有 "+(h+a+1)+" 用户参与");});}}e.find(" .progressing").css("width","");},zan_callback:function(f,b,a,c,e){var d=this;$(e).find("span.addNumber").fadeIn().animate({top:"-35px"},"normal").fadeOut(300);$(e).attr("class","zan current");zhiyou_relate.scored("#details-zan","current");if($(e).find("em").length>0){$(e).find("span.scoreAnimate").fadeIn().animate({top:"-35px"},"normal").fadeOut(300,function(){$(e).find("em").html(Number($(e).find("em").html())+1);});}else{if($(e).parents(".show_exp_zan").find("em").length>0){$(e).parents(".show_exp_zan").find("em").html(Number($(e).parents(".show_exp_zan").find("em").html())+1);}else{$(e).parents(".show_exp_zan").find(".grey").html("已有<em>1</em>人赞过");}}},add_rating:function(h,j,f,c,e){var g=this;if(h=="zan"){var k=g.zan_callback;$(e).removeAttr("onclick");$(e).css("cursor","default");}else{if(h=="zhi_list"){var k=g.zhi_list_callback;var d=$("#rating_worthy_"+j);var a=$("#rating_unworthy_"+j);d.removeAttr("onclick").css("cursor","default");a.removeAttr("onclick").css("cursor","default");if(c==1){d.addClass("current").addClass("worthCurrent");a.addClass("unworthCurrent");}else{d.addClass("worthCurrent");a.addClass("current").addClass("unworthCurrent");}}else{if(h=="zhi_in"){var k=g.zhi_detail_callback;var b=$("#rating_"+j);var d=$("#rating_worthy");var a=$("#rating_unworthy");d.removeAttr("onclick").css("cursor","default").addClass("worthCurrent");a.removeAttr("onclick").css("cursor","default").addClass("unworthCurrent");zhiyou_relate.scored("#details-zhi","worthCurrent");zhiyou_relate.scored("#details-buzhi","unworthCurrent");}}}$.ajax({type:"get",url:g.baseUrl+"user/rating/jsonp_add",data:{article_id:j,channel_id:f,rating:c},dataType:"jsonp",jsonp:"callback",success:function(l){k(l,j,f,c,e);},error:function(){}});},init_rating_by_cookie:function(){var f=[0,1,2,3,4,5,6,7,8,9,10,11,12,13];for(var d=1,a=f.length;d<a;d++){var b=f[d];var c="smzdm_rating_"+b;var e=getCookie(c);if(e){rating_cookie=json_decode(e);if(b==1||b==5||b==2){if($(".lrBot").length){$(".lrBot").each(function(){if(typeof($(this).find(" .good").attr("id"))!="undefined"){var g=$(this).find(" .good").attr("id").split("_")[2];if(g in rating_cookie){var h=$("#rating_worthy_"+g);if(h.length>0){var j=$("#rating_unworthy_"+g);h.removeAttr("onclick");j.removeAttr("onclick");if(rating_cookie[g]==1){h.addClass("current").css("cursor","default").addClass("worthCurrent");j.css("cursor","default").addClass("unworthCurrent");}else{if(rating_cookie[g]==-1){h.css("cursor","default").addClass("worthCurrent");j.addClass("current").css("cursor","default").addClass("unworthCurrent");}}}}}});}else{if($(".zan_fav_com").length){$(".zan_fav_com").each(function(){if(typeof($(this).find(" .zan").attr("id"))!="undefined"){var g=$(this).find(" .zan").attr("id").split("_")[2];if(g in rating_cookie){var h=$("#rating_worthy_"+g);if(h.length>0){h.removeAttr("onclick");if(rating_cookie[g]==1){h.addClass("current").css("cursor","default");}}}}});}}$(".score_rateBox").each(function(){if(typeof($(this).attr("id"))!="undefined"){var g=$(this).attr("id").split("_")[1];if(g in rating_cookie){var h=$("#rating_worthy");if(h.length>0){var j=$("#rating_unworthy");h.removeAttr("onclick").css("cursor","default");j.removeAttr("onclick").css("cursor","default");h.addClass("worthCurrent");j.addClass("unworthCurrent");scored("#details-zhi","worthCurrent");scored("#details-buzhi","unworthCurrent");}}}});}else{$(".zan").each(function(){var k=$(this).attr("id");if(typeof(k)!="undefined"){var g=k.split("_");var h=g[3];var j=g[2];if(b==j&&h in rating_cookie){$(this).attr("class","zan current");$(this).removeAttr("onclick");$(this).css("cursor","default");}}});}}}}};zhiyou_relate.init();