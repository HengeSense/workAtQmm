(function(c){c.tools=c.tools||{version:"@VERSION"};c.tools.overlay={addEffect:function(e,f,g){b[e]=[f,g]},conf:{close:null,closeOnClick:false,closeOnEsc:false,closeSpeed:"fast",effect:"default",fixed:!c.browser.msie||c.browser.version>6,left:"center",load:false,mask:"#000",oneInstance:true,speed:"fast",target:null,top:"10%"}};var d=[],b={};c.tools.overlay.addEffect("default",function(i,h){var g=this.getConf(),e=c(window),f=this.getOverlay();if(g.fixed&&f.height()+i.top<e.height()){i.position="fixed"}else{i.top+=e.scrollTop();i.left+=e.scrollLeft();i.position="absolute"}f.css(i).fadeIn(g.speed,h)},function(e){this.getOverlay().fadeOut(this.getConf().closeSpeed,e)});function a(h,m){var o=this,f=h.add(o),n=c(window),k,j,i,e=c.tools.expose&&(m.mask||m.expose),l=Math.random().toString().slice(10);if(e){if(typeof e=="string"){e={color:e}}e.closeOnClick=e.closeOnEsc=false}var g=m.target||h.attr("rel");j=g?c(g):null||h;if(!j.length){throw"Could not find Overlay: "+g}if(h&&h.index(j)==-1){h.click(function(p){o.load(p);return p.preventDefault()})}c.extend(o,{load:function(v){var q,w;if(o.isOpened()){return o}var s=b[m.effect];if(!s){throw'Overlay: cannot find effect : "'+m.effect+'"'}if(m.oneInstance){c.each(d,function(){this.close(v)})}q=o.getOverlay();w=q.find("img[data-original]");if(w.length){w.each(function(){var x=c(this),y=x.attr("data-original");x.attr("src",y).removeAttr("data-original")})}v=v||c.Event();v.type="onBeforeLoad";f.trigger(v);if(v.isDefaultPrevented()){return o}i=true;if(e){c(j).expose(e)}var u=m.top,t=m.left,p=j.outerWidth(true),r=j.outerHeight(true);if(typeof u=="string"){u=u=="center"?Math.max((n.height()-r)/2,0):parseInt(u,10)/100*n.height()}if(t=="center"){t=Math.max((n.width()-p)/2,0)}s[0].call(o,{top:u,left:t},function(){if(i){v.type="onLoad";f.trigger(v)}});if(e&&m.closeOnClick){c.mask.getMask().one("click",o.close)}if(m.closeOnClick){c(document).on("click."+l,function(x){if(!c(x.target).parents(j).length){o.close(x)}})}if(m.closeOnEsc){c(document).on("keydown."+l,function(x){if(x.keyCode==27){o.close(x)}})}return o},close:function(p){if(!o.isOpened()){return o}p=p||c.Event();p.type="onBeforeClose";f.trigger(p);if(p.isDefaultPrevented()){return}i=false;b[m.effect][1].call(o,function(){p.type="onClose";f.trigger(p)});c(document).off("click."+l+" keydown."+l);if(e){c.mask.close()}return o},getOverlay:function(){return j},getTrigger:function(){return h},getClosers:function(){return k},isOpened:function(){return i},getConf:function(){return m}});n.on("resize",function(){var p=o.getOverlay();p.css("left",(n.width()-p.width())/2+"px")});c.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(q,p){if(c.isFunction(m[p])){c(o).on(p,m[p])}o[p]=function(r){if(r){c(o).on(p,r)}return o}});colsersSelector=m.close||".close";k=j.find(colsersSelector);if(!k.length&&!m.close){k=c('<a class="close"></a>');j.prepend(k)}j.on("click",colsersSelector,function(p){o.close(p)});if(m.load){o.load()}}c.fn.overlay=function(e){var f=this.data("overlay");if(f){return f}if(c.isFunction(e)){e={onBeforeLoad:e}}e=c.extend(true,{},c.tools.overlay.conf,e);this.each(function(){f=new a(c(this),e);d.push(f);c(this).data("overlay",f)});return e.api?f:this}})(jQuery);